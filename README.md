threads.c/threads.h - работа с потоками.

threads_asm.S - переключение потоков

Всего может быть до 2^16 потоков, есть список свободных и список используемых.
Нулевой поток - исходный поток, он всегда жив.

threads_init - инициализирует потоки: их список, а так же таймер

schedule - простой планировщик, вызывает yield приблизительно каждые 10 мс
thread_create - создает поток с заданной функцией и аргументом к ней, возвращает идентификатор, удаляет поток из списка свободных.
При создании потока инициализируем ему стек: пихаем адрес exit_with_no_code на случай, если вернемся из функции, которая крутится внутри потока, без вызова thread_exit.
Далее пихаем указатель на функцию, ее аргумент, а потом значения нужных регистров (включая регистр флагов, все флаги, в том числе флаг прерываний, сброшены).

thread_start - запуск потока.

thread_run - восстановление потока (в том смысле, что он уже был запущен. Вызывается yield-ом)     

thread_join: спим, пока состояние потока не равно WAIT_FOR_JOIN - это означает, что он успешно завершился, и даже почистили стек. 
После чего добавляем этот поток в список свободных. 

yield - поток говорит, что он хочет дать поработать кому-то другому, просто берем следующий по списку поток, выполняем его.

thread_exit(code) - выйти из потока, записать code как результат выполнения потока (нужно для join). Если не вызван явно, то считаем, что код нулевой.
